; Top Design: "PCB_Deemb_lib:B3_R2_v2:schematic"
; Netlisted using Hierarchy Policy: "Standard"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=yes TopDesignName="PCB_Deemb_lib:B3_R2_v2:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0

er=3.140 tune{ 2.4 to 3.8 by 0.01 } opt{ 2.2 to 3.8 }

highfreq=107.385 tune{ 0.01 to 50 by 1 } opt{ 0.01 to 1000 }
S_Param:SP1 CalcS=yes CalcY=no CalcZ=no GroupDelayAperture=1e-4 FreqConversion=no FreqConversionPort=1 StatusLevel=2 CalcNoise=no SortNoise=0 BandwidthForNoise=1.0 Hz DevOpPtLevel=0 \
SweepVar="freq" SweepPlan="SP1_stim" OutputPlan="SP1_Output" 

SweepPlan: SP1_stim Start=0.01 GHz Stop=50.0 GHz Step=0.010 GHz 

OutputPlan:SP1_Output \
      Type="Output" \
      UseEquationNestLevel=yes \
      EquationNestLevel=2 \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2

#load "python","LinearCollapse"
Component Module="LinearCollapse" Type="ModelExtractor" NetworkRepresentation=2
Port:Term2  N__1 0 Num=2 Z=50 Ohm Noise=yes 
Port:Term1  N__2 0 Num=1 Z=50 Ohm Noise=yes 

cond=5.8*1e7
#uselib "ckt" , "S2P"
S2P:SNP2  N__4 N__0 0 File="C:\Work\EESof\Project\Huawei\PCB_Material\Implementation\Raw_Data\Data\Round_II\WUS_2_B_L3_Deemb_2.s2p" Type="touchstone" InterpMode="linear" InterpDom="" ExtrapMode="constant" Temp=27.0 CheckPassivity=0 
Port:Term3  N__4 0 Num=3 Z=50 Ohm Noise=yes 
Port:Term4  N__0 0 Num=4 Z=50 Ohm Noise=yes 

lowfreq=1000 tune{ 1 to 1000 by 10 } opt{ 1 to 100000 }

Rz_drum=0.265
Rz_matte=1.725

H1=6.23670
H2=6.943
T1=0.6
W=7.02

mytand=0.00107781 tune{ 0.001 to 0.01 by 0.0001 } opt{ 0 to 0.01 }
PC_Line:TL1  N__2 N__1 N=1 S=0 Subst="Subst1" Length=10 in W=W mil Layer=2 ReuseRLGC=0 W_FileFormat=0 
model Subst1 Substrate N=3 Er[1]=er H[1]=H1 mil TanD[1]=mytand T[1]=T1 mil Cond[1]=cond Er[2]=er H[2]=H2 mil TanD[2]=mytand T[2]=T1 mil Cond[2]=cond T[3]=T1 mil Cond[3]=cond LayerType[1]="ground" LayerType[2]="signal" LayerType[3]="ground" DielectricLossModel=1 FreqForEpsrTanD=CF GHz LowFreqForTanD=lowfreq kHz HighFreqForTanD=highfreq THz RoughnessModel=3 Rz_drum=Rz_drum um Rz_matte=Rz_matte um 
OptimGoal:OptimGoal2 Expr="phase_diff" SimInstanceName="SP1" Weight=1 \
SpecLimitLine[1]="OptimGoal2_limit1" 
SpecLimitLine:"OptimGoal2_limit1" Type="LessThan" Max=5 Weight=1 

CF=5 noopt{ 1 to 20 }
OptimGoal:OptimGoal1 Expr="line_10inch_diff" SimInstanceName="SP1" Weight=10 \
IndepVar[1]="freq" \
SpecLimitLine[1]="OptimGoal1_limit1" SpecLimitLine[2]="OptimGoal1_limit2" 
SpecLimitLine:"OptimGoal1_limit1" Type="LessThan" Max=0.05 Weight=3 \
IndepVar[1]="freq" IndepMin[1]=1e+07 IndepMax[1]=2.7e+10 
SpecLimitLine:"OptimGoal1_limit2" Type="LessThan" Max=0.05 Weight=1 \
IndepVar[1]="freq" IndepMin[1]=4e+10 IndepMax[1]=4.5e+10 
aele smooth_diff=smooth_10inch-dB(S(4,3));
aele phase_diff=abs(phase_measured-phase_modeled);
aele line_10inch_diff=abs(smooth_10inch-dB(S(2,1)));
aele phase_measured=unwrap(phase(S(4,3)));phase_modeled=unwrap(phase(S(2,1)));
aele smooth_10inch=moving_average(dB(S(4,3)),500);

Optim:"Optim1" OptimType="hpVMO" ErrorForm="L2" MaxIters=2000 P=2 DesiredError=0.0 StatusLevel=4 FinalAnalysis="None" NormalizeGoals=no SetBestValues=yes SaveSolns=yes SaveGoals=yes SaveOptimVars=yes UpdateDataset=yes SaveNominal=yes SaveAllIterations=no UseAllOptVars=yes UseAllGoals=yes SaveCurrentEF=no InitialTempControlMode=0 InitialTemp=0.1 NumShootsPerIter=20 EnableCockpit=yes SaveAllTrials=no UseAdvTermCriteria=no CostRelativeTol=1.0e-8 LimitOfContSmallImprovement=5 

